(function(){function k(m,l){var n=$.grep(m,function(p,o){return l.indexOf(p)>=0});return n}function f(n){var l="";l+='<a href="'+n.url+'" class="card mb-15">';l+='<div class="card-body">';if(n.state!="open"){l+="<strike>"}l+='<h4 class="card-title">'+n.title+"</h4>";if(n.state!="open"){l+="</strike>"}l+="<small>";l+="<p>"+n.content.substring(0,250)+"...</p>";l+="<p>"+n.date+"</p>";l+="</small>";l+="</div>";l+='<div class="card-footer">';var o=n.label;var m=k(o,e);l+=m.join("|");l+="</div>";l+="</a>";return l}function a(n){for(var l=0;l<n.length;l++){var m=n[l];if(m.state=="open"){if("lat" in m&&"lon" in m){markerList.push([m.lat,m.lon,m.title,m.number,m.label.join("|")])}}}displayMap()}function d(o,l,q){var p=$("#search-results");if(o.length){var m="";var s=[];for(var n=0;n<o.length;n++){var r=l[o[n].ref];s.push(r)}s=s.sort(function(u,t){return -1*(parseInt(u.created_at)-parseInt(t.created_at))});m+='<div class="col-12">';for(var n=0;n<s.length;n++){var r=s[n];if(r.state=="open"){m+=f(r)}}m+="</div>";m+='<div class="col-12">';for(var n=0;n<s.length;n++){var r=s[n];if(r.state!="open"){m+=f(r)}}m+="</div>";p.html(m);a(s)}else{p.html("<li>Nessuna segnalazione trovata</li>")}}function b(n,l){var o=$("#search-results");if(Object.keys(l).length){var m="";var p=[];$.each(l,function(q,r){p.push(r)});p=p.sort(function(r,q){return -1*(parseInt(r.created_at)-parseInt(q.created_at))});m+='<div class="col-12">';$.each(p,function(q,r){if(!n||$.inArray(n,r.label.toLowerCase().split(","))>=0){if(r.state=="open"){m+=f(r)}}});m+="</div>";m+='<div class="col-12">';$.each(p,function(q,r){if(!n||$.inArray(n,r.label.toLowerCase().split(","))>=0){if(r.state!="open"){m+=f(r)}}});m+="</div>";a(p);o.html(m)}else{o.html("<li>Nessuna segnalazione trovata</li>")}}function i(l){var n=window.location.search.substring(1);var o=n.split("&");for(var m=0;m<o.length;m++){var p=o[m].split("=");if(p[0]===l){return decodeURIComponent(p[1].replace(/\+/g,"%20"))}}}function g(l,m,p){NProgress.start();if(l){for(var o in window.store){if(!m||$.inArray(m,window.store[o].label.toLowerCase().split(","))>=0){h.addDoc({id:o,title:window.store[o].title,content:window.store[o].content,state:window.store[o].state,date:window.store[o].date,label:window.store[o].label,provincia:window.store[o].provincia,regione:window.store[o].regione})}}var n=h.search(l,{fields:{title:{boost:10},regione:{boost:5},provincia:{boost:5}},bool:"AND"});d(n,window.store,p)}else{b(m,window.store,p)}NProgress.done()}var e=["Alloggi","acquisto solidale","Bambini","Bollettino","Bufale","Contatti","Donazioni","Fabbisogni","Notizie Utili","Ospitalita animali","Raccolte Fondi"];var c=i("query");var j=i("label");if(j){document.getElementById("labelchoice").value=j;j=j.toLowerCase()}NProgress.start();if(c){document.getElementById("search-box").setAttribute("value",c)}var h=elasticlunr(function(){this.use(elasticlunr.it);this.addField("title",{boost:10});this.addField("label");this.addField("content");this.addField("state");this.addField("provincia",{boost:5});this.addField("regione",{boost:5});this.setRef("id")});setTimeout(function(){if(window.store){g(c,j,e)}},0)})();document.getElementById("search-box").onkeydown=function(a){if(a.keyCode==13){NProgress.start()}};